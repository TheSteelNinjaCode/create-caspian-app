<div class="container py-10">
  <div class="max-w-2xl mx-auto bg-white shadow-sm rounded p-6">
    <div class="flex items-start gap-4">
      <svg
        class="w-10 h-10 text-red-600"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        aria-hidden
      >
        <path
          d="M11.001 2a1 1 0 0 1 .998 0L21 7v9a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V7l8.001-5z"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M12 8v4"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M12 16h.01"
          stroke="currentColor"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>

      <div class="flex-1">
        <h1 class="text-2xl font-semibold text-red-600">
          Something went wrong
        </h1>
        <p class="mt-2 text-sm text-gray-600">
          We're sorry â€” an unexpected error occurred. Try reloading or return to
          the homepage.
        </p>

        <p class="mt-3 text-sm text-gray-700">[[error_message]]</p>

        <div class="mt-4 flex flex-wrap gap-2">
          <a
            href="/"
            class="inline-block px-3 py-1.5 bg-gray-100 border border-gray-200 rounded text-sm text-gray-800 hover:bg-gray-200"
            >Home</a
          >
          <button
            class="inline-block px-3 py-1.5 bg-blue-600 text-white rounded text-sm"
            onclick="reloadPage()"
          >
            Reload
          </button>
          [% if error_trace %]
          <button
            id="toggleTraceBtn"
            class="inline-block px-3 py-1.5 bg-transparent border border-gray-200 rounded text-sm text-black"
            onclick="setShowTrace(showTrace => !showTrace)"
          >
            {showTrace ? "Hide details" : "Show details"}
          </button>
          [% endif %]
        </div>
      </div>
    </div>

    [% if error_trace %]
    <div id="traceArea" class="mt-4" hidden="{!showTrace}">
      <div class="flex items-center justify-between mb-2">
        <div class="text-xs text-gray-500">Error details (soft copy)</div>
        <div class="flex gap-2">
          <button
            class="px-2 py-1 text-xs bg-gray-100 border rounded text-black"
            onclick="copyTrace()"
          >
            {showCopyTrace ? "Copied" : "Copy"}
          </button>
          <button
            class="px-2 py-1 text-xs bg-gray-100 border rounded text-black"
            onclick="downloadTrace()"
          >
            Download
          </button>
        </div>
      </div>
      <pre
        id="tracePre"
        class="p-4 bg-gray-100 rounded overflow-auto text-xs text-black"
      >[[error_trace]]</pre>
    </div>
    [% endif %]
  </div>
</div>

<script>
  const [showTrace, setShowTrace] = pp.state(false);
  const [showCopyTrace, setShowCopyTrace] = pp.state(false);

  function reloadPage() {
    window.location.reload();
  }

  function copyTrace() {
    const tracePre = document.getElementById("tracePre");
    navigator.clipboard.writeText(tracePre.innerText);

    setShowCopyTrace(true);
    setTimeout(() => {
      setShowCopyTrace(false);
    }, 2000);
  }

  function downloadTrace() {
    const tracePre = document.getElementById("tracePre");
    const blob = new Blob([tracePre.innerText], {
      type: "text/plain",
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "error_trace.txt";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>
